---
title: 《 GAMES101 》学习笔记
date: 2021-10-16 19:16:35
mathjax: true
category:
    - 计算机科学
---

这门课是万恶的安主席推荐的，但毕竟已经进入渲染这个计算机方向，这门课必然是首先需要学明白的课程。总之现在这个笔记，既可以是我自己的学习笔记，也是图形学兴趣小组的整理笔记，也可以是技能引导文档，同时也是目前实验室的工作。属于是真的赢麻了。

<!-- more -->

$$
\newcommand{\b}{\boldsymbol}
\newcommand{\lv}{\left(\begin{matrix}}
\newcommand{\rv}{\end{matrix}\right)}
$$

## 课程简介

本课程主要分为四个部分，即光栅化、曲线与曲面、光线追踪、动画仿真。

**光栅化（ Rasterization ）**指的是将三维图形实时显示在二维平面上。在图形学中， 30 FPS 就可以认为是实时的，低于这个帧率的则认为是离线渲染。

**光线追踪（ Ray tracing ）**指的是像每一个像素发射光，令光线不断反射。这样的技术能够让渲染更加真实，但是效率会更低。使用光线追踪是效果和效率的 Trade-off 。

### 图形学与计算机视觉

从二维图像和三维模型的角度出发，我们认为一切以三维模型为起点的都是**计算机图形学（ Computer graphics ）**的范畴，而所有从二维图像为起点的都是**计算机视觉（ Computer vision ）**。特别的，从三维模型出发获得二维图像的称为**渲染（ Rendering ）**，从三维模型出发获得新的三维模型的可以是**模拟（ Simulation ）**。但是上述的分类也是粗糙而模糊的。

## 线性代数回顾

{% note success %}
这里我们默认大家线性代数都挺好的。
{% endnote %}

首先明确记号，向量 $\b{a}$ 的长度标记为 $\|\b{a}\|$ 。与向量 $\b{a}$ 同方向的单位向量标记为 $\hat{\b{a}}$ ，其满足：

$$
\hat{\b{a}} = \frac{\b{a}}{\|\b{a}\|}
$$

向量的加减运算、点乘和叉乘运算省略。

另外，该课程明确向量默认为列向量，比如说二维向量表示为：

$$
\b{a} = \lv x \\ y \rv
$$

在这个标记下，三维向量的叉乘可以表示为：

$$
\b{a} = \lv x_a \\ y_a \\ z_a \rv, \b{b} = \lv x_b \\ y_b \\ z_b \rv \Rightarrow \b{a}\times\b{b} = \lv y_az_b - y_bz_a \\ z_ax_b - x_az_b \\ x_ay_b - y_ax_b \rv
$$

此外还需要正交基、矩阵的基本计算等基本知识。

## 齐次坐标系统

矩阵可以用于描述线性变换，常见的线性变换包括缩放、反射、切变、旋转。但是注意，在图形学中有一个常见变换并不能简单用矩阵表述，即**平移变换**，其不满足一般的线性变换定义（变换不保原点）。考虑下述二维空间平移：

$$
\begin{cases}
x' = x + t_x \\
y' = y + t_y \\
\end{cases}
$$

实际上一种解决方式是给点和向量的表述添加一个维度。我们将向量 $\b{a} = \lv x \\ y \rv$ 转换为下述标记：

$$
\b{a} = \lv x \\ y \\ 0 \rv
$$

将点 $A(x, y)$ 转换为下述标记：

$$
A = \lv x \\ y \\ 1 \rv
$$

并且人为规定第三维度必须归一化，即：

$$
\lv x \\ y \\ w \rv := \lv x / w \\ y / w \\ 1 \rv(w \neq 0)
$$

在这种标记下，向量的线性运算得到的依然是向量，点与点的差得到向量，点与点的和得到中点，向量和点的线性运算得到点。这些性质都是符合直觉的。

那么上述的平移变换（变换均指的是对点的变换）在这个标记下就可以表示为：

$$
\lv x' \\ y' \\ 1 \rv = \lv 1 & 0 & t_x \\ 0 & 1 & t_y \\ 0 & 0 & 1 \rv \lv x \\ y \\ 1 \rv
$$

实际上，上述所有的变换均可以被统一表示为：

$$
\lv x' \\ y' \\ 1 \rv = \lv a & b & t_x \\ c & d & t_y \\ 0 & 0 & 1 \rv \lv x \\ y \\ 1 \rv
$$

这些变换统称**仿射变换（ Affine transformation ）**，仿射变换即对某一个点先进行线性变换后再平移的一类变换（考虑到变换复合没有交换律，注意顺序不能变）。仿射变换的矩阵具有一定的结构，即左上角的子阵表示除去平移之外的变换对应的矩阵，右侧的一列则代表平移量。

这种添加维度以表示平移的坐标系统为**齐次坐标**。

### 三维旋转

这里着重介绍 Rodrigue 旋转公式，考虑绕轴 $\b{n}$ 逆时针旋转 $\alpha$ ，这个变换的矩阵可以表示为：

$$
\b{R}(\b{n}, \alpha) = \cos\alpha \b{I} + (1 - \cos\alpha) \b{n}\b{n}^T + \sin\alpha\lv
0 & -n_z & n_y \\
n_z & 0 & -n_x \\
-n_y & n_x & 0 \\
\rv
$$

这是一个三阶矩阵，构成的是齐次坐标意义下的变换矩阵的左上角子阵。

## MVP 变换

我们的渲染过程一般分为三个部分，即 Modeling 、 View 和 Projection ，这一整个变换过程就是 MVP 变换。

Modeling 一般可以认为是定义相机的位置的过程，定义相机需要三个量：

- 位置矢量（ Position ） $\b{e}$

- 相机朝向（ Gaze direction ） $\hat{\b{g}}$

- 向上方向（ Up direction ） $\hat{\b{t}}$

位置矢量定义了相机的位置，之后需要使用相机朝向定义观测方向，但是除此之外，我们需要使用向上方向定义相机最后的旋转形态（同一位置且朝向相同的相机依然有一个旋转自由度）。

另外，我们考虑到如果相机和物体进行了完全一致的变换，那么最后渲染结果不应当变化。所以说我们默认 Modeling 最后的结果为：

- 相机在原点

- 相机朝向 $-z$ ，向上方向为 $y$

相机定位完毕后（即 Modeling 完成后），后续所有对物体的变换均需要对相机进行同样的变换。

---

现在推导 Modeling 变换的矩阵，考虑原先的相机形态为 $(\b{e}, \hat{\b{g}}, \hat{\b{t}})$ 。

Modeling 过程可以这样考虑，即首先将相机平移到原点，随后旋转调整相机。平移的矩阵显然是：

$$
\b{T}_v = \lv
1 & 0 & 0 & -x_e \\
0 & 1 & 0 & -y_e \\
0 & 0 & 1 & -z_e \\
0 & 0 & 0 & 1 \\
\rv
$$