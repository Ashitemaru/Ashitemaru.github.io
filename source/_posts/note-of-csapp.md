---
title: CSAPP 学习笔记
date: 2021-06-29 20:21:52
mathjax: true
category:
    - 计算机科学
---

这个笔记基本基于 Computer System: A Programmer Perspective 这本书，学习的动机就是想要摸索一下计算机的结构，估计对汇编、计组、 OS 这些课有点帮助吧。

<!-- more -->

## 计算机系统简介

### 源代码的编译

首先明晰两个概念，只通过 ASCII 字符构成的文件称为**文本文件**，其余的文件称为**二进制文件**。

之后明晰一个基本约定，也就是无论是整数、浮点数、字符串、机器指令，它们都是**比特串**。区分它们的方式是根据**上下文**按照不同的方式解析比特串。

基于此我们探讨源代码到可执行文件的过程。

---

对于一个 C 语言的文件 `hello.c` ，计算机将其转化为可以被计算机执行的二进制文件的过程称为**编译**。编译过程又可以分为预处理、编译、汇编、链接四个过程。注意作为四个过程之一的编译和代指整体过程的编译之间是有区别的，并非一个概念。考虑下面的程序：

{% codeblock lang:c C %}
#include <stdio.h>

int main() {
    printf("Hello, world!");
    return 0;
}
{% endcodeblock %}

**预处理**指的是将程序中的 `#` 开头的语句进行替换。这里我们引用了头文件 `stdio.h` ，则预处理过程中这个语句将会被替换为头文件 `stdio.h` 之中的内容。

**编译**指的是将预处理过后的源代码转化为汇编代码，比如说上述 C 语言代码就会被转化为：

{% codeblock lang:assemble Assembly %}
main:
    subq $8, %rsp
    movl $.LCO, %edi
    call puts
    movl $0, %edx
    addq $8, %rsp
    ret
{% endcodeblock %}

**汇编**指的是将汇编语言程序转化为**可重定位目标程序（ relocatable object program ）**。

**链接**就是将各个需要的可重定位目标程序链接为一个可执行目标文件，这样就完成了整个工作。

当然上面的描述实际上还是很粗糙，所以后续我们会继续细节化这里面的过程。

### 系统执行可执行文件

#### 系统的架构

在讲述系统是如何执行可执行文件之前，我们需要了解计算机系统的架构。一个常见的硬件体系可以是：

![](/uploads/note-of-csapp/chap1-hardware-system.png "常见的硬件体系")

这里我们分别简单说明一下这些组成部分。

**总线**是负责在各个组件之间传递信息的管道，一般情况下其会被设计为一个固定长度的字节块，被称为**字（ word ）**。字中的字节数被称为**字长**，不同系统中的字长会不同，比如说 64 位系统的字长就是 8 ， 32 位系统的字长则是 4 。

**主存**也被叫做内存，是一个临时存储设备。从逻辑上来说，主存是一个字节数组，每个字节都有其唯一的索引。

**处理器（ CPU ）**的职责是运行机器指令，其核心是**程序计数器（ Program counter / PC）**，程序计数器记录当前所执行的指令在主存之中的地址。在任何时候，处理器永远都在执行 PC 所指向的指令并相应操作后更新 PC ，之后继续执行。

处理器内部一般包含寄存器以及算术逻辑单元（ ALU ）。寄存器是一个较小的存储设备，而 ALU 负责较为具体的计算工作。
